<!DOCTYPE html>
<html lang="en">
<%- include('./partials/header.ejs')-%>
<body>

    <%- include('./partials/navbar.ejs')-%>

    <section id="connect" class="connect">

        <div class="container" data-aos="fade-up">

            <div class="card" style="margin-top: 20px">
                <div class="card-header">
                    <h4>Add Asset</h4>
                </div>

                <div class="card-body">

                    <form id="addAssetForm" action="/add_asset" method="POST">

                        <input type="hidden" name="sessionId" value="<%=(typeof sessionId === "string") ? sessionId : "none"%>"/>

                        <div class="row">
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetNameInput" class="control-label">Asset Name</label>
                                    <input class="form-control" id="assetNameInput" name="asset_name" type="text" placeholder="Name" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetBrandInput" class="control-label">Brand</label>
                                    <input class="form-control" id="assetBrandInput" name="brand" type="text" placeholder="Brand, i.e. Apple" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetModelInput" class="control-label">Model</label>
                                    <input class="form-control" id="assetModelInput" name="model" type="text" placeholder="Model, i.e. A2338" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetSerialInput" class="control-label">Serial No</label>
                                    <input class="form-control" id="assetSerialInput" name="serial_no" type="text" placeholder="Serial No" required>
                                </div>
                            </div>
                        </div>

                        <br />

                        <div class="row">
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetPurchaseDateInput" class="control-label">Purchase Date</label>
                                    <input class="form-control" id="assetPurchaseDateInput" name="purchase_date" type="date" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetCostInput" class="control-label">Cost</label>
                                    <input class="form-control" id="assetCostInput" name="cost" type="number" placeholder="Cost" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetVendorInput" class="control-label">Vendor</label>
                                    <input class="form-control" id="assetVendorInput" name="vendor" type="text" placeholder="Vendor, i.e. Amazon" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetLifeInput" class="control-label">Useful Life</label>
                                    <input class="form-control" id="assetLifeInput" name="useful_life" type="number" placeholder="Useful Life" required>
                                </div>
                            </div>
                        </div>

                        <br />

                        <div class="row">
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetMaintenanceInput" class="control-label">Maintenance Schedule</label>
                                    <select class="form-control" id="assetMaintenanceInput" name="maintenance_schedule" required>
                                        <option value="weekly">Weekly</option>
                                        <option value="biweekly">Biweekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="quarterly">Quarterly</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetCategoryInput" class="control-label">Category</label>
                                    <select class="form-control" id="assetCategoryInput" name="category_id" required>

                                        <% if (typeof categories === "object" && Array.isArray(categories) === true) { %>

                                        <% categories.forEach((category) => { %>
                                        <option value=<%=category.category_id %>><%=category.category_name %></option>
                                        <% }); %>

                                        <% } %>
                                    </select>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label for="assetSiteInput" class="control-label">Location</label>
                                    <select class="form-control" id="assetSiteInput" name="location_id" required>

                                        <% if (typeof sites === "object" && Array.isArray(sites) === true) { %>

                                        <% sites.forEach((site) => { %>
                                        <option data-site_id=<%=site.site_id %> value=<%=site.location_id %>><%=`${site.site_name} - ${site.location_name}` %></option>
                                        <% }); %>

                                        <% } %>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <br />

                        <input class="btn btn-primary" type="submit" value="Add Asset" />
                    </form>
                </div>

            </div>

            <div class="card" style="margin-top: 20px">
                <div class="card-header">
                    <h4>Add Asset Category</h4>
                </div>

                <div class="card-body">
                    <form class="form-inline" id="addCategoryForm" action="/add_category" method="POST">
                        <input type="hidden" name="sessionId" value="<%=(typeof sessionId === "string") ? sessionId : "none"%>"/>
                        <div class="form-group">
                            <label for="categoryNameInput" class="control-label">Category Name</label>
                            <div class="input-group mb-3">
                                <input class="form-control" id="categoryNameInput" name="category_name" type="text" placeholder="Category Name">
                                <div class="input-group-append">
                                    <input class="btn btn-primary" type="submit" value="Add" >
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div>

            <div class="card" style="margin-top: 20px; margin-bottom: 20px">
                <div class="card-header">
                    <h4>Add Site</h4>
                </div>

                <div class="card-body">
                    <form id="addSiteForm" action="/add_site" method="POST">
                        <input type="hidden" name="sessionId" value="<%=(typeof sessionId === "string") ? sessionId : "none"%>"/>

                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label for="siteNameInput" class="control-label">Site Name</label>
                                    <input class="form-control" id="siteNameInput" name="site_name" type="text" placeholder="Site Name">
                                </div>
                            </div>
                        </div>

                        <br />

                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label for="basicLocationNameInput" class="control-label">Site Location Name</label>
                                    <input class="form-control" id="basicLocationNameInput" name="location_name" type="text" placeholder="Site Location Name">
                                </div>
                            </div>
                        </div>

                        <br />

                        <input class="btn btn-primary" type="submit" value="Add Site" />
                    </form>
                </div>

            </div>

            <div class="card" style="margin-top: 20px; margin-bottom: 20px">
                <div class="card-header">
                    <h4>Add Location to Site</h4>
                </div>

                <div class="card-body">
                    <form id="addLocationForm" action="/add_location" method="POST">
                        <input type="hidden" name="sessionId" value="<%=(typeof sessionId === "string") ? sessionId : "none"%>"/>

                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label for="addLocationSiteInput" class="control-label">Location Site</label>
                                    <select class="form-control" id="addLocationSiteInput" name="site_id" required>

                                        <% if (typeof sites === "object" && Array.isArray(sites) === true) { %>
                                        <% var addedSites = []; %>
                                        <% sites.forEach((site) => { %>
                                        <% if (sites.includes(site.site_name) === false) { %>
                                            <% sites.push(site.site_name); %>
                                            <option value=<%=site.site_id %>><%=site.site_name %></option>
                                        <% }}); %>

                                        <% } %>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <br />

                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label for="locationNameInput" class="control-label">New Location Name</label>
                                    <input class="form-control" id="locationNameInput" name="location_name" type="text" placeholder="New Location Name">
                                </div>
                            </div>
                        </div>

                        <br />

                        <input class="btn btn-primary" type="submit" value="Add Location to Site" >
                    </form>
                </div>

            </div>

            <!-- DataTables stylesheet (required for table sorting icons and others) -->
            <link rel="stylesheet" href="https://cdn.datatables.net/1.11.1/css/dataTables.bootstrap4.min.css">

            <!-- jQuery (required for DataTables) -->
            <script
                src="https://code.jquery.com/jquery-3.6.0.min.js"
                integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
                crossorigin="anonymous">
            </script>

            <!-- Popper (required for DataTables) -->
            <script
                src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.6.0/umd/popper.min.js"
                integrity="sha512-BmM0/BQlqh02wuK5Gz9yrbe7VyIVwOzD1o40yi1IsTjriX/NGF37NyXHfmFzIlMmoSIBXgqDiG1VNU6kB5dBbA=="
                crossorigin="anonymous"
                referrerpolicy="no-referrer">
            </script>

            <!-- DataTables scripts (required for them to have functionality) -->
            <script src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.min.js"></script>
            <script src="https://cdn.datatables.net/1.11.1/js/dataTables.bootstrap4.min.js"></script>

            <script src="assets/js/dashboard.js"></script>

            <table id="assetTable" class="table table-striped table-bordered" style="width: 100%">
                <thead>
                    <tr>
                        <th colspan="1" rowspan="2">Id</th>
                        <th colspan="1" rowspan="2">Name</th>
                        <th colspan="1" rowspan="2">Category</th>
                        <th colspan="2">Type</th>
                        <th colspan="2">Location</th>
                    </tr>

                    <tr>
                        <th class="th-sm" data-sortable="true">Brand</th>
                        <th class="th-sm" data-sortable="true">Model</th>
                        <th class="th-sm" data-sortable="true">Site</th>
                        <th class="th-sm" data-sortable="true">Location</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <% if (typeof assets === "object" && Array.isArray(assets) === true) { %>

                    <% assets.forEach((asset) => { %>

                    <% console.log(asset) %>

                    <tr>
                        <td><%=asset.asset_id %></td>
                        <td><%=asset.asset_name %></td>
                        <td><%=asset.category_name %></td>
                        <td><%=asset.brand %></td>
                        <td><%=asset.model %></td>
                        <td><%=asset.site_name %></td>
                        <td><%=asset.location_name %></td>
                    </tr>

                    <% }); %>
                    <% } %>
                </tbody>
            </table>

            <script>
                $("#assetTable").DataTable({
                    pagingType: "full"
                });
            </script>

        </div>

    </section>

    <%- include('./partials/footer.ejs')-%>

    <!-- Modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Database Operation</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div id="messageModalBody" class="modal-body">
                <p id="modalMessage"><%=(typeof message === "string") ? message : "" %></p>
            </div>
        </div>
        </div>
    </div>

</body>

</html>
